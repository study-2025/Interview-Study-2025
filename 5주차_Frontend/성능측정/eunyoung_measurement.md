# **웹 성능 측정**

모던 브라우저의 SEO(검색엔진최적화)에 있어 **사용자 경험 최적화가 더욱 중요**해졌다. Google 및 기타 검색 엔진은 **UX를 웹사이트 순위의 중요한 요인으로 강조**하고 있다.

이는 웹사이트가 사용하기 쉽고, 빠르게 로드되며, 모든 장치에서 액세스 할 수 있는 웹 사이트를 만드는 데 집중해야 함을 의미한다.

웹사이트를 UX에 맞게 최적화하려면 페이지 속도, 모바일 응답성, 탐색 등의 요소에 집중해야 한다. 이를 위해서는 명확하고 간결한 메뉴와 링크를 사용해 웹 사이트를 탐색하기 쉽게 만들어야 한다. 또한 빠른 로딩을 위해 이미지와 비디오를 최적화하고 다양한 화면 크기에 적응하는 반응형 디자인을 사용하여 최적화된 환경을 조성해 나가야 한다.

## Core Web Vitals?

**`코어 웹 바이탈`**(Core Web Vitals)은 검색 엔진 결과 순위에 영향을 미치는 **3가지 웹 성능 측정 값**이다.

여기서 바이탈은 바이탈 체크할 때의 뜻과 같다. 생명 유지에 필수적인 요소들을 말한다. 따라서 웹 바이탈은 웹사이트의 생명을 유지하는 데 필수적인 요소들을 말한다고 할 수 있다.

여기에는 사이트의 전반적 로딩 속도, 상호작용, 웹페이지의 시각적 안정성, 보안 문제 등 여러 요소를 포함하고 있다.

구글에서는 웹 사이트에 방문하는 유저들의 경험을 좌우하는 여러 요소들 중 가장 기본이자 핵심 지표로 보기 때문에 ‘**코어(Core)**’라는 단어를 붙여 부른다.

다시 말해 **`코어 웹 바이탈`**은 웹페이지 유저들의 사용 경험을 측정하는 구글의 표준화된 측정 항목 집합이다. 구글 검색을 효과적으로 활용하고 전체적으로 유저들에게 좋은 환경을 제공하려면 우수한 코어 웹 바이탈을 유지해야 한다.

## 코어 웹 바이탈 측정 항목

![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2b6748e-ba74-4d54-a235-94c36f9d61cb/1b5c088e-b155-4b73-8558-ed5a2c01d67a/Untitled.png)

**`코어 웹 바이탈`**은 다음과 같은 사용자 경험의 3가지 기본 영역에 대한 지표를 생성하여 사용자 경험 문제를 식별한다.

모든 항목은 최소 75% 페이지 방문에서 평균 수치를 평가한다.

1. **최대 콘텐츠 렌더링 시간 (Largest Contentful Paint, LCP)**
   1. **로드 성능**을 측정한다. 우수한 사용자 환경을 제공하려면 페이지가 처음 로드되기 시작한 후 **2.5초 이내**에 LCP가 발생해야한다.
   2. 웹 페이지가 완전히 로드되는 시간을 측정하는 것이 아니라, 가장 중요한 부분이 로드되는 시점에만 집중한다. 즉 뷰포트 내에서 가장 큰 페이지 요소(큰 텍스트 블록, 이미지 또는 비디오)를 표시하는 데 걸리는 시간을 측정한다.
2. **다음 페인트에 대한 상호작용 (Interaction to NextPaint, INP)**
   1. **상호작용, 응답성**을 측정한다. 우수한 사용자 환경을 제공하려면 페이지의 INP가 **200밀리초 이하**여야 한다.
   2. INP는 특정한 작업을 수행한 후 페이지 요소가 얼마나 빨리 반응하는 지를 측정한다. 예를 들어 어떤 버튼을 클릭하면 페이지가 새 콘텐츠를 렌더링하는데 걸리는 시간을 측정하고 이를 INP 점수로 보고한다.
3. **사용자 관점에서 본 페이지의 시각적 안정성 (Cumulative Layout Shift, CLS)**
   1. **시각적 안정성**을 측정한다. 우수한 사용자 환경을 제공하려면 CLS를 **0.1. 이하**로 유지해야한다.
   2. CLS는 모바일 중심의 지표이다. 데스크톱 웹사이트에는 화면 크기 문제가 대부분 존재하지 않는다. CLS는 특히 페이지 요소가 화면에서 얼마나 자주 이동하는 지 측정한다. 이로 인해 사용자가 작은 모바일 화면의 콘텐츠와 상호작용하기가 어려워질 수 있다. 화면 요소가 이동하는 일반적 원인으로는 사용자가 이미 페이지 콘텐츠와 상호작용하고 탐색하기 시작한 후에 렌더링되는 광고, 이미지 및 기타 레이아웃 요소가 있다.
   3. 따라서 페이지가 로드될 때 페이지의 요소가 너무 많이 움직인다면 CLS가 높다는 것이므로 개선이 필요하다.

## 코어 웹 바이탈 측정 방법

![https://www.youtube.com/watch?v=k6cIORruI7g](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2b6748e-ba74-4d54-a235-94c36f9d61cb/88c8e976-b72a-41e4-a0e6-0a409aa2caf8/Untitled.png)

https://www.youtube.com/watch?v=k6cIORruI7g

- [Chrome UX 보고서 (CrUX)](https://www.cloudflare.com/ko-kr/learning/performance/what-are-core-web-vitals/)
  - chrome 사용자가 보고한 필드 데이터를 제공해 사이트 소유자에게 실제 사용자가 웹 사이트를 어떻게 경험하는지에 대한 데이터를 제공한다.
  - https://developer.chrome.com/docs/crux/dashboard/?hl=ko#access_the_crux_dashboard
  - [e.kakao.com](http://e.kakao.com) 의 코어 웹바이탈 측정 결과 🤓
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2b6748e-ba74-4d54-a235-94c36f9d61cb/161cac70-553c-49b1-8810-08a7eb431ac1/Untitled.png)
- [Google Lighthouse](https://developer.chrome.com/docs/lighthouse/overview/)
  - 코어 웹 바이탈에 대한 실험실 지표를 제공하는 무료 도구이다. 성능, SEO, 접근성 등을 개선하기 위한 실행 가능한 통찰력을 제공한다.
  - e.kakao.com의 Lighthouse 측정 결과 🤓
    개발자 도구로 측정 가능
    ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2b6748e-ba74-4d54-a235-94c36f9d61cb/5ea59a43-7c12-4d64-9d61-8ff7e80c1c1b/Untitled.png)
- [Google PageSpeed Insights](https://pagespeed.web.dev/)
  - CrUX와 Lighthouse의 기능을 결합하여 CWV 및 기타 웹 바이탈에 대한 현장 및 실험실 데이터를 모두 제공한다. 사용자는 PageSpeed Insight를 사용하여 웹 사이트 소유 여부에 관계 없이 웹 사이트의 성능을 확인할 수 있다.
  - [e.kakao.com](http://e.kakao.com) 의 PageSpeed Insights 측정 결과 🤓
    ![데스크톱](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2b6748e-ba74-4d54-a235-94c36f9d61cb/9431e30a-4747-4f66-a37c-e33d48e22be6/Untitled.png)
    데스크톱
    ![모바일](https://prod-files-secure.s3.us-west-2.amazonaws.com/e2b6748e-ba74-4d54-a235-94c36f9d61cb/be463ae4-5db2-4393-8bb5-28149c787382/Untitled.png)
    모바일
- [Google Seacrh Console](https://search.google.com/search-console/about)
- [web-vitals](https://github.com/GoogleChrome/web-vitals) 라이브러리 사용

## 코어 웹 바이탈 최적화 방법

### LCP 개선 방법

- 콘텐츠 전송 네트워크(CDN, Content Delivery Network) 사용
  - CDN은 전 세계 곳곳에 콘텐츠를 캐시하여 콘텐츠가 사용자에게 더 빨리 도달하도록 돕는다.
- 이미지 최적화
  - 이미지는 페이지에서 가장 큰 요소인 경우가 많다. 이미지 파일 크기를 줄이면 이미지 로드 시간을 단축하는 데 도움이 될 수 있다
- 지연 로딩 구현
  - 지연 로딩에서는 웹 사이트 리소스가 사용자가 필요로 할 때만 로드된다. 이 기능은 웹사이트 로딩을 어느 정도 효율적으로 만들어주지만, 연구 결과에 따르면 이 기능을 과도하게 사용하면 LCP가 낮아진다고 한다. 이러한 이유로 Google에서는 지연 로딩 이미지를 ‘접는 부분 아래’, 즉 사용자가 스크롤해야 볼 수 있는 웹 페이지 부분으로 제한할 것을 권장한다.

### INP 개선 방법

- JavaScript 함수 크기 줄이기
  - 코드가 많은 동적 웹 페이지는 브라우저에서 코드를 실행하기 전에 모든 코드가 로드될때까지 기다려야 하므로 입력 지연이 발생할 수 있다. Javascript를 최소화하면 이 프로세스를 더 빠르게 진행할 수 있다.
- 정적 웹 페이지 구축
  - 정적 HTML 웹 페이지가 동적 페이지보다 훨씬 빠르게 로드되며, 특히 CDN을 통해 배포할 경우 더욱 그렇다.
- 불필요한 타사 도구와 스크립트를 제거
  - 웹 사이트에 추가 도구를 로드하면 성능이 느려질 수 있다. 웹 사이트에서 타사 도구의 양을 줄이면 일반적으로 FID 및 웹 사이트 속도를 향상시킬 수 있다.
- will change 속성?
-

### CLS 개선 방법

- 타사 페이지 요소 최소화
  - 페이지의 타사 요소는 페이지의 나머지 부분과 별도의 위치에서 로드된다. 때문에 페이지가 로드될 때 페이지의 레이아웃이 변경되어 약간 다른 시간에 로드될 수 있다. 이러한 타사 요소의 사용을 최소화하면 결과적으로 레이아웃 이동 횟수가 줄어든다.
- 임베디드 콘텐츠를 위한 공간 예약
  - 광고와 같은 많은 타사 요소는 웹 사이트의 기능이나 비즈니스 모델에 필수적이며 제거할 수 없다. 개발자는 브라우저가 실제 요소를 가져오기 전에 이러한 요소가 로드될 수 있도록 웹 페이지에 공간을 예약할 수 있다.
- 이미지가 최적의 크기로 로드되는지 확인
  - 이것은 일반적인 이미지 최적화와는 약간 다른 프로세스이다. 데스크톱 컴퓨터, 태블릿, 스마트폰은 모두 화면 크기가 다르므로 조금씩 다른 크기의 이미지가 필요하다. 브라우저가 데스크톱에 최적화된 큰 이미지를 먼저 로드한 다음 사용중인 장치가 스마트폰이므로 모바일에 최적화된 이미지를 가져와야 하는 경우, 크기가 다른 이미지가 로드될 때 페이지의 콘텐츠가 이리저리 이동할 수 있다.
- 이미지 및 비디오의 높이와 너비 포함
  - 높이 및 너비 속성은 이미지 또는 비디오가 로드되기 전에 해당 공간을 예약할 수 있도록 브라우저에 이미지의 크기를 알려준다.
- CSS 가로 세로 비율 상자 사용
  - 개발자가 가로 세로 비율을 사용해 페이지 요소의 공간을 보존하는 데 사용할 수 있는 여러 CSS 기법이 있다.

## 사용자 중심 성능 지표

참고: https://web.dev/articles/user-centric-performance-metrics?hl=ko

!https://developers.google.com/static/search/blog/images/page-experience-signal.png?hl=ko

- 이전에 웹 성능은 [`load`](https://developer.mozilla.org/docs/Web/API/Window/load_event) 이벤트를 사용하여 측정되었다. 그러나 `load` 이벤트가 발생되는 순간이 사용자의 페이지 로드 경험과는 반드시 일치하지는 않는다.
- 예를 들어 서버는 즉시 '로드'되는 최소 페이지로 응답할 수 있지만, `load` 이벤트가 실행되고 몇 초 후까지 콘텐츠 가져오기나 페이지의 항목 표시를 연기할 수 있다. 이러한 페이지의 로드 시간은 기술적으로 빠르지만 사용자의 페이지 로드 경험과는 일치하지 않는다.
- 이처럼 웹페이지 성능 및 실적은 상대적이므로, 구글에서는 사용자가 웹페이지 성능을 경험하는 방식을 더 정확하게 측정하는 측정 항목을 표준화 하기 위해 노력해왔다.
- 그리고 다음과 같은 유형을 측정하기로 하였다.
  - **인지된 로드 속도:** 페이지가 모든 시각적 요소를 화면에 로드하고 렌더링하는 속도
  - **로드 반응성:** 구성요소가 사용자 상호작용에 빠르게 응답하는 데 필요한 자바스크립트 코드를 페이지가 얼마나 빨리 로드하고 실행할 수 있는 지를 나타냄
  - **런타임 응답성:** 페이지가 로드된 후 사용자 상호작용에 얼마나 빠르게 응답할 수 있는지 나타냄
  - **시각적 안정성:** 페이지의 요소가 사용자가 예상하지 않는 방식으로 이동하여 상호작용을 방해할 수 있는 지?
  - **부드러움:** 전환 및 애니메이션이 일관된 프레임 속도로 렌더링되고 한 상태에서 다음 상태로 유동적으로 흐르는 지?
- 그리고 이러한 유형들을 측정하기 위한 기준으로 다음과 같은 측정 기준을 만들었다. 여기에는 `Core Web Vitals`도 포함된다.
  - **콘텐츠가 포함된 첫 페인트 (FCP: First Content Paint)**
    - 페이지가 로드되기 시작한 시점부터 페이지 콘텐츠의 일부가 화면에 렌더링된 시점까지의 시간
    - 우수한 사용자 환경을 제공하려면 사이트의 FCP가 1.8초 이하여야 한다.
  - **최대 콘텐츠 렌더링 시간 (LCP: Largest Contentful Paint)**
    - 페이지 로드가 시작된 시점부터 화면에 가장 큰 텍스트 블록 또는 이미지 요소가 렌더링되는 시점까지의 시간
  - **다음 페인트와의 상호작용 (INP: Interaction to NextPaint)**
    - 페이지에서 이루어지는 모든 탭, 클릭 또는 키보드 상호작용의 지연 시간이다. 이 측정항목은 상호작용 수를 기준으로 페이지의 최악 (또는 최악에 가까운) 상호작용 지연 시간을 하나의 대표 값으로 선택하여 페이지의 전반적인 응답성을 나타낸다.
  - **총 차단 시간 (TBT: Total Blocking Time)**
    - FCP와 [상호작용 시작 시간 (TTI)](https://web.dev/articles/tti?hl=ko)(Time to Interact) 사이의 총시간으로, 입력 응답을 방지하기에 충분할 정도로 기본 스레드가 차단된 시간이다.
    - 즉 페이지 로드 이후 자바스크립트 실행과 같은 스레드 작업으로 인해 사용자의 입력에 응답할 수 없었던 총 시간을 측정한다.
  - **레이아웃 변경 횟수 (CLS: Cumulative Layout Shift)**
    - 페이지 로드 중 예기치 않은 레이아웃 이동의 빈도를 측정한다. 예를 들어, 사용자가 페이지를 읽는 동안 이미지나 광고가 로드되어 콘텐츠가 갑자기 이동하는 상황을 나타냅니다. 안정적인 레이아웃을 유지하는 것이 중요하다.
  - **첫 바이트까지의 시간 (TTFB : Time to First Byte)**
    - 브라우저가 서버에 요청을 보낸 후 첫 번째 바이트를 받을 때까지 걸리는 시간이다. 이 지표는 서버 응답 속도를 측정하는 데 유용하다.
    - TTFB는 다음 요청 단계의 합계이다.
      - 리디렉션 시간
      - 서비스 워크 시작 시간 (해당하는 경우)
      - DNS 조회
      - 연결 및 TLS 협상
      - 요청, 응답의 첫 번째 바이트가 도착할 때까지
    - 따라서 연결 설정 시간 및 백엔드 지연 시간을 줄이면 TTFB를 줄일 수 있다.
